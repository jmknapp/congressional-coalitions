<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>119th Congress Analysis, House of Representatives</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}?v=2024010310" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-university me-2"></i>
                119th Congress Analysis, House of Representatives
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/caucus-management" id="caucus-management-link" style="display: none;">
                    <i class="fas fa-users-cog me-1"></i>Caucus Management
                </a>
                <!-- Developer Mode Badge -->
                <span class="navbar-text" id="dev-mode-badge" style="display: none;">
                    <span class="badge bg-warning text-dark ms-2">
                        <i class="fas fa-code me-1"></i>DEV MODE
                    </span>
                </span>
            </div>
        </div>
    </nav>

    <div class="container mt-4">


        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-users fa-2x text-primary mb-2"></i>
                        <h5 class="card-title" id="total-members">-</h5>
                        <p class="card-text">Members</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-file-alt fa-2x text-success mb-2"></i>
                        <h5 class="card-title" id="total-bills">-</h5>
                        <p class="card-text">Bills</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-vote-yea fa-2x text-warning mb-2"></i>
                        <h5 class="card-title" id="total-rollcalls">-</h5>
                        <p class="card-text">Roll Calls</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-handshake fa-2x text-info mb-2"></i>
                        <h5 class="card-title" id="total-cosponsors">-</h5>
                        <p class="card-text">Cosponsors</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Time Period Indicator -->
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-light border-0 text-center mb-0" style="background-color: #f8f9fa;">
                    <small class="text-muted">
                        <i class="fas fa-calendar me-2"></i>
                        <span id="time-period-text">Loading time period...</span>
                    </small>
                </div>
            </div>
        </div>

        <!-- Analysis Controls (Hidden) -->
        <div class="row mb-4" style="display: none;">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-line me-2"></i>Coalition Analysis</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4">
                                <label for="congress-select" class="form-label">Congress:</label>
                                <select class="form-select" id="congress-select">
                                    <option value="119">119th Congress (Current)</option>
                                    <option value="118">118th Congress</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label for="window-select" class="form-label">Analysis Window:</label>
                                <select class="form-select" id="window-select">
                                    <option value="90">90 Days</option>
                                    <option value="180">180 Days</option>
                                    <option value="365">1 Year</option>
                                    <option value="1000">All Time</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">&nbsp;</label>
                                <button class="btn btn-primary w-100" onclick="runAnalysis()">
                                    <i class="fas fa-play me-2"></i>Run Analysis
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Results -->
        <div class="row mb-4" id="analysis-results" style="display: none;">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-chart-pie me-2"></i>Analysis Results</h5>
                    </div>
                    <div class="card-body">
                        <div id="analysis-content"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Tables -->
        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-users me-2"></i>House Members</h5>
                    </div>
                    <div class="card-body">
                        <!-- Party Filter Tabs -->
                        <ul class="nav nav-tabs mb-3" id="party-tabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="all-tab" data-bs-toggle="tab" data-bs-target="#all-members" 
                                        type="button" role="tab" aria-controls="all-members" aria-selected="true" onclick="filterMembersByParty('all')">
                                    All (<span id="all-count">-</span>)
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="democratic-tab" data-bs-toggle="tab" data-bs-target="#democratic-members" 
                                        type="button" role="tab" aria-controls="democratic-members" aria-selected="false" onclick="filterMembersByParty('D')">
                                    Democratic (<span id="dem-count">-</span>)
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="republican-tab" data-bs-toggle="tab" data-bs-target="#republican-members" 
                                        type="button" role="tab" aria-controls="republican-members" aria-selected="false" onclick="filterMembersByParty('R')">
                                    Republican (<span id="rep-count">-</span>)
                                </button>
                            </li>
                        </ul>
                        
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="members-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Party</th>
                                        <th>State</th>
                                        <th>Votes</th>
                                    </tr>
                                </thead>
                                <tbody id="members-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-file-alt me-2"></i>House Bills</h5>
                    </div>
                    <div class="card-body">
                        <!-- Loading spinner for bills -->
                        <div id="bills-loading-spinner" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading bills...</span>
                            </div>
                            <p class="mt-2 text-muted">Loading House bills...</p>
                        </div>
                        
                        <div class="table-responsive" id="bills-table-container" style="display: none;">
                            <table class="table table-striped table-hover" id="bills-table">
                                <thead>
                                    <tr>
                                        <th style="width: 15% !important;">Last Action</th>
                                        <th style="width: 4% !important;">Bill</th>
                                        <th style="width: 46% !important;">Title</th>
                                        <th style="width: 25% !important;">Sponsor</th>
                                        <th style="width: 10% !important;">Cosponsors</th>
                                    </tr>
                                </thead>
                                <tbody id="bills-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Network Visualization Section (Dev Mode Only) -->
        {% if dev_mode %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5><i class="fas fa-project-diagram me-2"></i>Co-sponsorship Network Analysis <span class="badge bg-warning text-dark ms-2">DEV</span></h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-8">
                                <p class="mb-3">
                                    <strong>Visualize co-sponsorship relationships</strong> between House members. 
                                    The network graph shows who co-sponsors whose bills, revealing bipartisan coalitions 
                                    and party dynamics.
                                </p>
                                <ul class="mb-3">
                                    <li><strong>Nodes:</strong> House members (colored by party)</li>
                                    <li><strong>Edges:</strong> Co-sponsorship relationships (A â†’ B means A co-sponsored B's bills)</li>
                                    <li><strong>Thicker edges:</strong> More co-sponsorships between those members</li>
                                    <li><strong>Tooltips:</strong> Show specific bills involved in each relationship</li>
                                </ul>
                            </div>
                            <div class="col-md-4 text-center">
                                                              <a href="/network" class="btn btn-primary btn-lg me-2">
                                  <i class="fas fa-project-diagram me-2"></i>
                                  View Full Network
                              </a>
                              <a href="/network/simplified" class="btn btn-success btn-lg">
                                  <i class="fas fa-filter me-2"></i>
                                  View Simplified Network
                              </a>
                                <p class="text-muted mt-2 small">
                                    Interactive visualization with 10,000+ co-sponsorship relationships
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-md-12 mb-4">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5><i class="fas fa-vote-yea me-2"></i>Roll Call Votes</h5>
                        {% if dev_mode %}
                        <a href="/network" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-project-diagram me-1"></i>View Network
                        </a>
                        {% endif %}
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped table-hover" id="rollcalls-table">
                                <thead>
                                    <tr>
                                        <th>Roll Call</th>
                                        <th>Question</th>
                                        <th>Date</th>
                                        <th>Yea</th>
                                        <th>Nay</th>
                                        <th>Present</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="rollcalls-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cross-Party Voters Section -->
    <div class="container">
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5><i class="fas fa-exchange-alt me-2"></i>Cross-Party Voters</h5>
                        <small class="text-muted">Members who frequently vote across party lines</small>
                    </div>
                    <div class="card-body">
                        <!-- Loading spinner for cross-party voters -->
                        <div id="crossparty-loading-spinner" class="text-center py-4">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading cross-party voters...</span>
                            </div>
                            <p class="mt-2 text-muted">Analyzing voting patterns...</p>
                        </div>
                        
                        <div class="table-responsive" id="crossparty-table-container" style="display: none;">
                            <table class="table table-striped table-hover" id="crossparty-table">
                                <thead>
                                    <tr>
                                        <th>Member</th>
                                        <th>Party</th>
                                        <th>State</th>
                                        <th>Cross-Party %</th>
                                        <th>Cross-Party Votes</th>
                                        <th>Total Votes</th>
                                    </tr>
                                </thead>
                                <tbody id="crossparty-tbody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Vote Details Modal -->
    <div class="modal fade" id="voteModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Vote Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="vote-details"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cosponsor Details Modal -->
    <div class="modal fade" id="cosponsorModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Cosponsor Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cosponsor-details"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}?v={{ range(1000, 9999) | random }}"></script>
    
    <!-- Developer Mode Script -->
    <script>
        // Developer mode functionality
        let developerMode = false;
        
        // Check if developer mode was previously enabled (localStorage)
        if (localStorage.getItem('developerMode') === 'true') {
            enableDeveloperMode();
        }
        
        // Listen for Shift+Ctrl+D key combination
        document.addEventListener('keydown', function(event) {
            if (event.shiftKey && event.ctrlKey && event.key.toLowerCase() === 'd') {
                event.preventDefault();
                toggleDeveloperMode();
            }
        });
        
        function toggleDeveloperMode() {
            if (developerMode) {
                disableDeveloperMode();
            } else {
                enableDeveloperMode();
            }
        }
        
        function enableDeveloperMode() {
            developerMode = true;
            localStorage.setItem('developerMode', 'true');
            
            // Show developer badge
            const devBadge = document.getElementById('dev-mode-badge');
            if (devBadge) {
                devBadge.style.display = 'block';
            }
            
            // Show Caucus Management link
            const caucusLink = document.getElementById('caucus-management-link');
            if (caucusLink) {
                caucusLink.style.display = 'block';
            }
            
            console.log('ðŸš€ Developer Mode ENABLED - Caucus Management available');
        }
        
        function disableDeveloperMode() {
            developerMode = false;
            localStorage.setItem('developerMode', 'false');
            
            // Hide developer badge
            const devBadge = document.getElementById('dev-mode-badge');
            if (devBadge) {
                devBadge.style.display = 'none';
            }
            
            // Hide Caucus Management link
            const caucusLink = document.getElementById('caucus-management-link');
            if (caucusLink) {
                caucusLink.style.display = 'none';
            }
            
            console.log('ðŸ”’ Developer Mode DISABLED - Caucus Management hidden');
        }
        
        // Show current mode in console on page load
        console.log(`Developer Mode: ${developerMode ? 'ENABLED' : 'DISABLED'} (Shift+Ctrl+D to toggle)`);
    </script>
</body>
</html>
